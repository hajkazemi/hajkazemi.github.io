define("mediaRichText/bi/errors.json",[],function(){return{MEDIA_RICH_TEXT_WRONG_COMP_DATA:{errorCode:32e3,severity:"fatal",params:{p1:"wixCompJson",p2:"errorDesc",p3:"errorStack"}},MEDIA_RICH_TEXT_UNSUPPORTED_COMPONENT:{errorCode:32001,severity:"fatal",params:{p1:"wixCompJson"}},MEDIA_RICH_MISSING_COMPONENT_PLACEHOLDER:{errorCode:32002,severity:"fatal",params:{p1:"dataQuery"}}}}),define("mediaRichText/bi/errors",["mediaRichText/bi/errors.json","lodash","utils"],function(e,t,i){"use strict";return t.forEach(e,function(e,t){e.errorName=t}),i.logger.register("mediaRichText","error",e),e}),define("mediaRichText/galleryHelpers/galleryHelpers",["lodash","utils"],function(e,t){"use strict";function i(e){return e===o}function n(e){return e===l}function r(e,t){var r=e.width;return{width:r,height:function(e,t){var r=0;if(i(t.componentType)){var a=t.cols,o=t.rows,s=2*t.margin,l=Math.round((e-(a-1)*s)/a),p=m*l;r=Math.round(p*o)+(o-1)*s+26}else n(t.componentType)&&(r=Math.round(m*e));return r}(r,t),position:"relative"}}function a(a,o,l){var c=a.componentType,m=e.assign({dataQuery:a.dataQuery,propertyQuery:a.dataQuery,componentType:a.componentType,type:"Component",style:r(l,a),compData:{type:"ImageList",items:e.map(a.imageList,function(t){var i=e.get(o,t.dataQuery);return e.assign({},t,i,{type:"Image",id:t.id+t.uri,isRef:!1,metaData:{isHidden:!1,isPreset:!0,schemaVersion:"1.0"}})}),metaData:{isPreset:!0,schemaVersion:"1.0",isHidden:!1}}},function(e){var r={};return i(e.componentType)?r={skin:s,compProp:{type:"MatrixGalleryProperties",metaData:{schemaVersion:"1.0"},expandEnabled:!0,imageMode:e.fixedSize?"clipImage":"flexibleWidthFixed",numCols:e.cols,maxRows:e.rows,incRows:2,margin:2*e.margin,alignText:"left"}}:n(e.componentType)?r={skin:p,compProp:{autoplay:e.autoplay,autoplayInterval:e.autoplayInterval,bidirectional:!1,expandEnabled:!0,imageMode:"flexibleWidthFixed",metaData:{schemaVersion:"1.0"},reverse:!1,showAutoplay:!0,showCounter:!0,showExpand:!1,showNavigation:!0,showSocial:!1,transDuration:1,transition:"swipeHorizontal",type:"SlideShowGalleryProperties"}}:t.log.error("Unknown gallery type: "+e.componentType),r}(a));return n(c)&&(m.styleId=t.santaTypes.shortenStyleId(p)),i(c)&&(m.styleId=t.santaTypes.shortenStyleId(s)),m}var o="wysiwyg.viewer.components.MatrixGallery",s="wysiwyg.viewer.skins.gallerymatrix.BlogMatrixGallery",l="wysiwyg.viewer.components.SlideShowGallery",p="skins.viewer.gallery.BlogSlideShow",c=[o,l],m=.75;return{buildGalleryJsonFromCkData:a,isGalleryComponent:function(t){return e.includes(c,t)}}}),define("mediaRichText/wixMusicEmbedMixin/wixMusicEmbedMixin",["lodash"],function(e){"use strict";return{getInitialState:function(){return{height:this.props.height}},onPlayerMessage:function(e){"resizeOfWixMusicIframe"===e.data.event&&e.data.playerId===this.props.playerId&&this.setState({height:e.data.size.maxHeight})},componentDidMount:function(){window.addEventListener("message",this.onPlayerMessage)},componentWillUnmount:function(){window.removeEventListener("message",this.onPlayerMessage)},getIframeProps:function(){return e.assign({},this.props,{height:this.state.height})}}}),define("mediaRichText/mediaRichTextStylesCollector/mediaRichTextStylesCollector",["lodash","skins","core","utils"],function(e,t,i,n){"use strict";var r=t.skinsMap;i.styleCollector.registerClassBasedStyleCollector("wysiwyg.viewer.components.MediaRichText",function(e,t,i,a){for(var o=/(<img[^>]*wix-comp="([^"]+)"[^>]*>)/g,s=void 0;s=o.exec(e.dataItem.text);){var l=JSON.parse(s[2].replace(/&quot;/g,'"')),p="";l.skin&&r.get(l.skin)&&(p=l.skin),p&&!a[p]&&(a[n.santaTypes.shortenStyleId(p)]=e.structure.skin)}})}),define("mediaRichText",["lodash","core","utils","coreUtils","compUtils","create-react-class","santaProps","textCommon","mediaRichText/bi/errors","mediaRichText/galleryHelpers/galleryHelpers","mediaRichText/wixMusicEmbedMixin/wixMusicEmbedMixin","mediaRichText/mediaRichTextStylesCollector/mediaRichTextStylesCollector"],function(e,t,i,n,r,a,o,s,l,p,c){"use strict";function m(e,t){try{return function(e,t){var i=JSON.parse(e.replace(/&quot;/g,'"'));return i.url=t,i}(e,t)}catch(t){return void this.props.siteAPI.reportBI(l.MEDIA_RICH_TEXT_WRONG_COMP_DATA,{wixCompJson:e,errorDesc:t.message,errorStack:t.stack})}}function d(t){return e.assign(t,{wixComp:!0})}function u(t){return e.isFunction(t.type)&&t.props.wixComp}function h(e){return e.replace(/^#/,"")}function y(t){var i=this.props.siteData,n=this.props.id,r=function(t,i){var n=e.get(t,"structure.layout",{});return n.width&&(n.width=Math.min(i,n.width)),e.assign({},t.structure,{dataItem:t.compData,propertiesItem:t.compProp,layout:n,id:t.structure.id,type:t.structure.componentType,structure:t.structure})}(t,this._getMediaRichTextComponentWidth()),a=r.id;i.registerMediaRichTextInnerComponent(n,a,r)}var g=a({displayName:"wixMusicEmbed",mixins:[c],render:function(){return t.createReactElement("iframe",d(this.getIframeProps()))}}),f=n.fragment,w=s.textComponentsUtils,C={wline:"div"},T={displayName:"MediaRichText",mixins:[s.textCompMixin],allowIframes:!0,convertCompDataTextToHTML:function(t){this.componentDataQueryList=e.map(t.compData.componentDataList||[],h),this._compData=t.compData,this._componentHtml=this._componentHtml.replace(/\n|\r|\t/g,""),this._componentHtml=w.convertDataQueryLinksIntoHtmlAnchors(this._componentHtml,t.compData.linkList,e.partialRight(i.linkRenderer.renderLink,t.siteData,t.rootNavigationInfo)),this._componentHtml=w.mobileTextTransformIfNeeded(this._componentHtml,{brightness:e.get(t,"compProp.brightness"),isMobileView:t.siteData.isMobileView(),scale:e.get(t,"structure.layout.scale"),fontGetter:t.siteData.getFont.bind(t.siteData),colorGetter:t.siteData.getColor.bind(t.siteData)}),this.renderedDataQueries={},this._componentHtml=this._convertComponentsPlaceHoldersToRenderedComponents(this._componentHtml),e.size(this.renderedDataQueries)!==e.size(this.componentDataQueryList)&&e(this.componentDataQueryList).without(e.keys(this.renderedDataQueries)).forEach(function(e){this.props.siteAPI.reportBI(l.MEDIA_RICH_MISSING_COMPONENT_PLACEHOLDER,{dataQuery:"#"+e})}.bind(this)),this._registerReLayoutFunc=t.registerReLayout},_addToCompDataListIfMissing:function(t){var i=h(t);e.includes(this.componentDataQueryList,i)||this.componentDataQueryList.push(i)},_convertNodeFragmentToReactElements:function(i){if(i.nodeType===f.Node.ELEMENT_NODE){var n=e.reduce(i.attributes,function(t,i){return"style"===i.name?t.style=e.reduce(i.value.split(";"),function(t,i){var n=i.split(":");return 2===n.length&&(t[e.camelCase(n[0])]=n[1]),t},{}):"class"===i.name?t.className=i.value:"frameborder"===i.name?t.frameBorder=i.value:e.startsWith(i.name,"data-")?t[i.name]=i.value:t[e.camelCase(i.name)]=i.value,t},{});if(function(t,i){return t&&!e.has(C,i.tagName.toLowerCase())}(n.wixComp,i)){var r=m.call(this,n.wixComp,n.src);return r?this._handleInnerComps(r,n):""}var a=function(e){return e.childNodes&&1===e.childNodes.length&&e.childNodes[0].nodeType===f.Node.TEXT_NODE}(i)?i.textContent:e.flatMap(i.childNodes,this._convertNodeFragmentToReactElements);if(e.isArray(a)&&a.length&&e.every(a,u))return a;var o=e.includes(this.voidElements,i.tagName.toLowerCase())?n:e.assign(n,{children:a});return t.createReactElement(function(e){return C[e]||e}(i.tagName.toLowerCase()),o)}return i.nodeType===f.Node.TEXT_NODE?i.textContent:""},voidElements:["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","isindex","keygen","link","menuitem","meta","nextid","param","source","track","wbr"],_convertComponentsPlaceHoldersToRenderedComponents:function(t){var i=f.document.createElement("div");return i.innerHTML=t,e.map(i.childNodes,this._convertNodeFragmentToReactElements)},_validateAndFixGalleryCompData:function(t,i){var n=e.clone(t),r=p.buildGalleryJsonFromCkData(i,this._compData.innerCompsData,t.style);return e.assign(n,r),function(t){var i=e.cloneDeep(t.compData);t.compData.items=e.map(t.compData.items,function(t){return e.assign({galleryData:i},t)})}(n),n},_createInnerComponentProperties:function(t){var i=this._createInnerComponentBasicProperties(t);return"wysiwyg.viewer.components.WPhoto"===t.componentType||"wysiwyg.viewer.components.Video"===t.componentType?function(t,i){return e.has(t,"post-cover-photo")&&(i.addItemProp=!0),i}(t,i):p.isGalleryComponent(t.componentType)?this._validateAndFixGalleryCompData(i,t):(this.props.siteAPI.reportBI(l.MEDIA_RICH_TEXT_UNSUPPORTED_COMPONENT,{wixCompJson:t}),i)},_getMediaRichTextComponentWidth:function(){return function(){var e=this.props.siteData.measureMap;return e&&(this._lastMeasuredWidth=e.width[this.props.id]),this._lastMeasuredWidth}.call(this)||e.get(this.props,"style.width")||630},_createInnerComponentBasicProperties:function(t){var i=function(t){var i=t.id||"innerComp_"+t.dataQuery.replace("#","");return e.assign(t,{id:i})}(t),n=e.get(this._compData.innerCompsData,i.dataQuery),r=void 0;if("wysiwyg.viewer.components.WPhoto"===i.componentType){if(i.linkDataQuery){var a=i.linkDataQuery.slice(1);n.link=e.find(this._compData.linkList,{id:a})}r={displayMode:"fitWidthStrict"}}else"wysiwyg.viewer.components.Video"===i.componentType&&(r={showControls:"temp_show",enablejsapi:1});var s=o.componentPropsBuilder.getCompProps(i,this.props.siteAPI,this.props.rootId,null,{compData:n,compProp:r});return s.key=s.key||t.key,delete s.ref,s.registerReLayout=this._registerReLayoutFunc||this.registerReLayout,function(e,t){var i=e.style;i.marginTop="10px",i.marginBottom="10px",i.marginLeft=t.marginLeft,i.marginRight=t.marginRight,i.position="static"}(s,i),function(e,t){var i=t.style;e.floatValue?(i.float=e.floatValue,i.display="",i.clear=""):(i.display=e.display,i.clear="both",i.float="")}(i,s),this._calcInnerCompWidthAndHeight(i,s),s},_calcInnerCompWidthAndHeight:function(t,i){var n=this._getMediaRichTextComponentWidth(),r=n,a=i.compData&&i.compData.width,o=t.width;e.isNumber(o)?r=this._getWidthMultiplier(t)*n:e.isNumber(a)&&(r=Math.min(a,n)),i.style.width=r,t.dimsRatio?i.style.height=i.style.width*t.dimsRatio:"wysiwyg.viewer.components.Video"===t.componentType&&(i.style.height=.5625*i.style.width)},_getWidthMultiplier:function(e){return this.props.siteData.isMobileView()?.99:e.width},_handleInnerComps:function(e,t){return"htmlComp"===e.componentType?this._handleHtmlComp(e,t):"music"===e.componentType?this._handleMusicComp(e,t):this._handleInnerSantaComponent(e)},_handleInnerSantaComponent:function(e){var t=this._createInnerComponentProperties(e),i=r.compFactory.getCompClass(e.componentType,!0);return this.renderedDataQueries[h(e.dataQuery)]=1,this._addToCompDataListIfMissing(e.dataQuery),y.call(this,t),i(d(t))},_handleHtmlComp:function(e,i){var n=this.props.siteData.serviceTopology.staticHTMLComponentUrl,r=void 0;if("website"===e.type)r="//"+function(e){return e.replace(/^(https?:)?\/\//,"")}(e.websiteUrl);else{r=("temp"===e.urlStatus?"//0.htmlcomponentservice.com/":n)+e.relativeUrl}if("center"===e.align?i.style={display:"block",clear:"both",margin:"0 auto"}:i.style={float:e.align},i.src=r,i.sandbox="allow-scripts allow-same-origin allow-popups",this.props.siteData.isMobileView()&&e.dimsRatio){if(i.width="99%",e.dimsRatio>1){var a=.99*(this._getMediaRichTextComponentWidth()?parseInt(this._getMediaRichTextComponentWidth(),10):1)*e.dimsRatio;i.height=a}}else i.width=e.width;return t.createReactElement("iframe",d(i))},_handleMusicComp:function(i,n){var r=e.get(this.props.siteData,["serviceTopology","scriptsLocationMap","wix-music-embed"]),a=/^[\w\-]+$/i,o=a.test(i.paymentId)||""===i.paymentId;if(a.test(i.albumId)&&a.test(i.presetId)&&o)return n.src=r+"/index.html?albumId="+i.albumId+"&paymentsId="+i.paymentId+"&presetId="+i.presetId+"&playerId="+i.playerId+"&hideDetailedTrackInfo=true",this.props.siteData.isMobileView()&&(n.src+="&isMobile=true"),n.sandbox="allow-scripts allow-same-origin allow-popups",n.playerId=i.playerId,delete n.wixComp,n.width="100%",t.createReactElement(g,n)},componentWillUnmount:function(){this.props.siteData.clearMediaRichTextInnerComponents(this.props.id)}};return t.compRegistrar.register("wysiwyg.viewer.components.MediaRichText",T,!0),T});
//# sourceMappingURL=mediaRichText.min.js.map